<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Reading Notes - Release It! | Notes</title>
  <meta name="author" content="Shichao Yuan">
  
  <meta name="description" content="Release It!
非常值得阅读的一本书，有些内容是大家都很熟悉的，有些是很少考虑的。
在此把书中提到的Patterns汇总罗列了一下~
Stability
Use Timeouts

HTTP/TCP设置Timeout；


Connection Timeout
Socket Timeout
">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Reading Notes - Release It!"/>
  <meta property="og:site_name" content="Notes"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Notes</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">		
			<h1> Reading Notes - Release It!</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p><a href="http://book.douban.com/subject/2065284/" target="_blank" rel="external">Release It!</a></p>
<p>非常值得阅读的一本书，有些内容是大家都很熟悉的，有些是很少考虑的。</p>
<p>在此把书中提到的Patterns汇总罗列了一下~</p>
<h2 id="stability">Stability</h2>
<h3 id="use-timeouts">Use Timeouts</h3>
<ol style="list-style-type: decimal">
<li>HTTP/TCP设置Timeout；</li>
</ol>
<ul>
<li>Connection Timeout</li>
<li>Socket Timeout</li>
<li>TIME_WAIT。</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>数据库操作设置timeout；</li>
<li>线程wait或tryLock设置timeout。</li>
</ol>
<p>处理超时问题，可以尝试queue-and-retry。关于retry的实现可以借鉴<a href="https://github.com/jhalterman/recurrent" target="_blank" rel="external">Recurrent</a></p>
<blockquote>
<p>Apply to <strong>Integration Points</strong>, <strong>Blocked Theads</strong>, and <strong>Slow Responses</strong></p>
<p>Apply to recover from unexpected failures</p>
<p>Consider delayed retries</p>
</blockquote>
<h3 id="circuit-breaker">Circuit Breaker</h3>
<p>“保险丝”模式</p>
<p>这个模式有个非常著名的实现——<a href="https://github.com/Netflix/Hystrix" target="_blank" rel="external">Hystrix</a></p>
<p>更重要的是对“保险丝”状态的监控</p>
<blockquote>
<p>Don’t do it if it hurts</p>
<p>Use together with <strong>Timeouts</strong></p>
<p>Expose, track, and report state changes</p>
</blockquote>
<h3 id="bulkheads">Bulkheads</h3>
<p>“消防卷帘门”模式（义译）</p>
<p>实际上就是对资源的隔离，也就是对故障的隔离。</p>
<p>隔离的粒度是个问题，目前很火的是基于<a href="https://www.docker.com/" target="_blank" rel="external">Docker</a>的容器级别隔离。</p>
<blockquote>
<p>Save part of the ship</p>
<p>Decide whether to accept less efficient use of resources</p>
<p>Pick a useful granularity</p>
<p>Very important with shared services model</p>
</blockquote>
<h3 id="steady-state">Steady State</h3>
<p>减少人为干预的同时防范无限增长的数据</p>
<p>使用内存缓存，注意限制大小，可以参考<a href="https://github.com/google/guava" target="_blank" rel="external">Guava</a>的CacheBuilder。</p>
<p>不要把日志留在线上机器，可以使用<a href="https://github.com/mozilla-services/heka" target="_blank" rel="external">heka</a>、<a href="http://kafka.apache.org/" target="_blank" rel="external">Kafka</a>等</p>
<blockquote>
<p>Avoid fiddling</p>
<p>Purge data with application logic</p>
<p>Limit caching</p>
<p>Roll the logs</p>
</blockquote>
<h3 id="fail-fast">Fail Fast</h3>
<p>顾名思义，检查输入，不行就挂。</p>
<blockquote>
<p>Avoid <strong>Slow Responses</strong> and <strong>Fail Fast</strong></p>
<p>Reserve resources, verify <strong>Integration Points</strong> early</p>
<p>Use for input validation</p>
</blockquote>
<h3 id="handshake">Handshake</h3>
<p>列几个例子：</p>
<ol style="list-style-type: decimal">
<li><a href="http://commons.apache.org/proper/commons-pool/" target="_blank" rel="external">Apache Commons Pool</a>中的testOnBorrow、testWhileIdle。</li>
<li><a href="https://github.com/Netflix/karyon" target="_blank" rel="external">karyon</a>中的HealthCheckHandler。</li>
<li><a href="https://github.com/Netflix/ribbon" target="_blank" rel="external">Ribbon</a>中的LoadBalancer。</li>
</ol>
<blockquote>
<p>Create cooperative demand control</p>
<p>Consider health checks</p>
<p>Build Handshaking into your own low-level protocols</p>
</blockquote>
<h3 id="test-harness">Test Harness</h3>
<p>测试</p>
<blockquote>
<p>Emulate out-of-spec failures</p>
<p>Stress the caller</p>
<p>Leverage shared harnesses for common failures</p>
<p>Supplement, don’t replace, other testing methods</p>
</blockquote>
<h3 id="decoupling-middleware">Decoupling Middleware</h3>
<p>多多了解，慎重选择</p>
<ol style="list-style-type: decimal">
<li>In-Process Method Calls</li>
</ol>
<ul>
<li>C Functions</li>
<li>Java Calls</li>
<li>Dynamic Libs</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Interprocess Communication</li>
</ol>
<ul>
<li>Shared Memory</li>
<li>Pipes</li>
<li>Semaphores</li>
<li>Windows Events</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Remote Procedure Calls</li>
</ol>
<ul>
<li>DCE RPC</li>
<li>DCOM</li>
<li>RMI</li>
<li>XML-RPC</li>
<li>HTTP</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Message Oriented Middleware</li>
</ol>
<ul>
<li>MQ</li>
<li>Pub-Sub</li>
<li>SMTP</li>
<li>SMS</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Tuple Spaces</li>
</ol>
<ul>
<li>JavaSpaces</li>
<li>TSpaces</li>
<li>GigaSpaces</li>
</ul>
<blockquote>
<p>Decide at the last responsible moment</p>
<p>Avoid many failure modes through total decoupling</p>
<p>Learn many architectures, and choose among them</p>
</blockquote>
<h2 id="capacity">Capacity</h2>
<p><strong>systems thinking</strong></p>
<blockquote>
<p>Understanding the capacity of any system requires <em>systems thinking</em>, as described by Peter Senge in The <em>Fifth Discipline</em> —the ability to think in terms of dynamic variables, change over time, and interrelated connections. No one simple formula will produce an all-encompassing “capacity number.”</p>
</blockquote>
<p>监控系统很重要，需要可以对比各种参数的相关性。</p>
<blockquote>
<p>C.A.R. Hoare famously said, “Premature optimization is the root of all evil.” This has often been misused as an excuse for sloppy design. Hoare’s full quote said, “We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil.” His true warning was against chasing small gains at the expense of complexity and development time.</p>
</blockquote>
<p>这句话不是Donald Knuth说的么…………</p>
<h3 id="pool-connections">Pool Connections</h3>
<p>各种“池”，必须的。</p>
<blockquote>
<p>Pool connections</p>
<p>Protect request-handling threads</p>
<p>Size the pools for maximum throughput</p>
</blockquote>
<h3 id="use-caching-carefully">Use Caching Carefully</h3>
<blockquote>
<p>Limit cache sizes</p>
<p>Build a flush mechanisum</p>
<p>Don’t cache trivial objects</p>
<p>Compare access and change frequency</p>
</blockquote>
<h3 id="precompute-content">Precompute Content</h3>
<blockquote>
<p>Precompute content that changes infrequently</p>
</blockquote>
<h3 id="tune-the-garbage-collector">Tune the Garbage Collector</h3>
<p>这个题目够写一本“砖头”书了。</p>
<p>详见<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/" target="_blank" rel="external">Java Platform, Standard Edition HotSpot Virtual Machine Garbage Collection Tuning Guide</a></p>
<blockquote>
<p>Tune the garbage collector in production</p>
<p>Keep it up</p>
<p>Don’t pool ordinary objects</p>
</blockquote>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
        

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2015/11/03/password-strengths-evaluation-pcfg/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2015-11-13 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/engineering/">engineering<span>4</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2015 Shichao Yuan
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




</body>
   </html>
